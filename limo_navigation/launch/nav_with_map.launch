<launch>
  <!-- ===== Args ===== -->
  <arg name="map_file" default="$(find limo_maps)/maps/lab_obstacle_map.yaml"/>
  <arg name="base_frame" default="base_link"/>
  <arg name="odom_frame" default="odom"/>
  <arg name="global_frame" default="map"/>
  <arg name="scan_topic" default="/scan"/>
  <arg name="cmd_vel_out" default="/cmd_vel"/>
  <arg name="use_sim_time" default="false"/>

  <param name="use_sim_time" value="$(arg use_sim_time)"/>

  <!-- Map server -->
  <node pkg="map_server" type="map_server" name="map_server" args="$(arg map_file)" output="screen"/>

  <!-- AMCL (map → odom 관리) -->
  <rosparam file="$(find limo_navigation)/params/amcl.yaml" command="load"/>
  <node pkg="amcl" type="amcl" name="amcl" output="screen">
    <param name="base_frame_id" value="$(arg base_frame)"/>
    <param name="odom_frame_id" value="$(arg odom_frame)"/>
    <param name="global_frame_id" value="$(arg global_frame)"/>
    <remap from="scan" to="$(arg scan_topic)"/>
  </node>

  <!-- move_base + TEB -->
  <rosparam file="$(find limo_navigation)/params/costmap_common.yaml" command="load" ns="move_base"/>
  <rosparam file="$(find limo_navigation)/params/global_costmap.yaml" command="load" ns="move_base"/>
  <rosparam file="$(find limo_navigation)/params/local_costmap.yaml"  command="load" ns="move_base"/>
  <rosparam file="$(find limo_navigation)/params/teb_local_planner.yaml" command="load" ns="move_base"/>

  <node pkg="move_base" type="move_base" name="move_base" output="screen">
    <rosparam param="base_local_planner">teb_local_planner/TebLocalPlannerROS</rosparam>
    <remap from="cmd_vel" to="$(arg cmd_vel_out)"/>
    <param name="planner_frequency" value="1.0"/>
    <param name="controller_frequency" value="10.0"/>
    <param name="recovery_behavior_enabled" value="true"/>
    <param name="clearing_rotation_allowed" value="true"/>
  </node>

  <!-- RViz -->
  <include file="$(find limo_navigation)/launch/rviz_nav.launch"/>
</launch>
